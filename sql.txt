hn := InputQuery('¡ÃØ³Ò¡ÃÍ¡ HN (7 ËÅÑ¡)', hn);

hn1 := GetSQLStringData('select hn from lab_head  '+
'where hn = "'+hn+'" and hn like "_______" ');
if (hn1 = '')then
repeat
ShowMessage('·èÒ¹ÂÑ§äÁèä´é¡ÃÍ¡ HN ËÃ×Í¡ÃÍ¡ HN ¼Ô´¾ÅÒ´');
hn := InputQuery('¡ÃØ³Ò¡ÃÍ¡ HN (7 ËÅÑ¡)', hn);
hn1 := GetSQLStringData('select hn from lab_head  '+
'where hn = "'+hn+'" and hn like "_______" ');
until(hn1 <> '');
if (hn1 <> '')then
begin
ShowMessage('¡ÃØ³ÒàÅ×Í¡ÇÑ¹·Õè');
end;



order_date_list := GetPickupList('select distinct order_date from lab_head '+
'where hn = "'+hn1+'" and hn <> "" and report_date is not null  and '+
'report_date <> ""  order by  order_date desc ');
if (order_date_list = '')then
repeat
ShowMessage('·èÒ¹ÂÑ§äÁèä´éàÅ×Í¡ÇÑ¹·Õè');
order_date_list := GetPickupList('select distinct order_date from lab_head '+
'where hn = "'+hn1+'" and hn <> "" and report_date is not null  and '+
'report_date <> ""  order by  order_date desc ');
until(order_date_list <> '');
if (order_date_list <> '')then
begin
ShowMessage('¡ÃØ³ÒàÅ×Í¡àÅ¢·ÕèãºÊÑè§ Lab');
end;

order_date1 := StrToDateTime(order_date_list);
order_date2:=formatdatetime('yyyy-mm-dd',order_date1);



lab_order_number_list := GetPickupList('select concat(lab_order_number," - ",form_name) as cc from lab_head '+
'where hn = "'+hn1+'" and order_date = "'+order_date2+'" '+
'and report_date is not null  and  report_date <> "" ');
if (lab_order_number_list = '') then
repeat
ShowMessage('·èÒ¹ÂÑ§äÁèä´éàÅ×Í¡ãºÊÑè§ LAB');
lab_order_number_list := GetPickupList('select concat(lab_order_number," - ",form_name) as cc from lab_head '+
'where hn = "'+hn1+'" and order_date = "'+order_date2+'" '+
'and report_date is not null  and  report_date <> "" ');
until(lab_order_number_list <> '');

lab_order_number := GetSQLStringData('select lab_order_number from lab_head  '+
'where concat(lab_order_number," - ",form_name) = "'+lab_order_number_list+'" ');



ChangeReportSQL('select concat(p.pname,p.fname,"  ",p.lname) as ptname, '+
'd.name as request_doctor_name,h.*,l.*,i.lab_items_unit,i.lab_items_normal_value,i.lab_items_name, '+
'i.service_price,i2.*,w.*,o.*,k.department,l1.lab_order_result,l.lab_items_sub_group_code, '+
'concat(os.bps,"/",os.bpd) as bpds,os.bw,os.temperature,os.rr,os.height,os.bmi,os.waist,os.pulse '+
'from lab_head h '+
'left outer join lab_order l on l.lab_order_number=h.lab_order_number and l.lab_order_result IS NOT NULL and l.lab_order_result<>"" '+
'left outer join lab_items i on i.lab_items_code=l.lab_items_code '+
'left outer join patient p on p.hn=h.hn '+
'left outer join doctor d on d.code=h.doctor_code '+
'left outer join ipt i2 on i2.an=h.vn '+
'left outer join ward w on w.ward = i2.ward '+
'left outer join ovst o on o.vn = h.vn '+
'left outer join kskdepartment k on k.depcode = o.main_dep '+
'left outer join lab_order l1 on l1.lab_order_number=h.lab_order_number and l1.lab_items_name_ref = "Dep_Q" '+
'left outer join opdscreen os on os.vn = h.vn '+
'where h.lab_order_number = "'+lab_order_number+'" '+
'and l.lab_order_number=h.lab_order_number '+
'and l.lab_order_result IS NOT NULL '+
'and l.lab_order_result<>"" '+
'and l.lab_items_name_ref <> "Dep_Q" '+
'order by l.lab_items_sub_group_code,i.display_order,i.lab_items_name');
